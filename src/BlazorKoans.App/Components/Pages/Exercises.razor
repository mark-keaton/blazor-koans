@page "/exercises"
@page "/exercises/{Category}"
@page "/exercises/{Category}/{ComponentName}"
@rendermode InteractiveServer

<PageTitle>Blazor Koans - Exercises</PageTitle>

<h1>Exercise Components</h1>

@if (string.IsNullOrEmpty(Category))
{
    <p>Select a category to explore the exercise components:</p>

    <div class="row">
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-success text-white">Beginner</div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><a href="exercises/beginner/HelloWorld">HelloWorld</a></li>
                        <li><a href="exercises/beginner/Greeting">Greeting</a></li>
                        <li><a href="exercises/beginner/Counter">Counter</a></li>
                        <li><a href="exercises/beginner/Card">Card</a></li>
                        <li><a href="exercises/beginner/BindingDemo">BindingDemo</a></li>
                        <li><a href="exercises/beginner/EventDemo">EventDemo</a></li>
                        <li><a href="exercises/beginner/ParentWithEventDemo">ParentWithEventDemo</a></li>
                        <li><a href="exercises/beginner/ParentWithFormDemo">ParentWithFormDemo</a></li>
                        <li><a href="exercises/beginner/LifecycleDemo">LifecycleDemo</a></li>
                        <li><a href="exercises/beginner/ConditionalDemo">ConditionalDemo</a></li>
                        <li><a href="exercises/beginner/LoopDemo">LoopDemo</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-warning">Intermediate</div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><a href="exercises/intermediate/FormDemo">FormDemo</a></li>
                        <li><a href="exercises/intermediate/RegistrationForm">RegistrationForm</a></li>
                        <li><a href="exercises/intermediate/ValidationDemo">ValidationDemo</a></li>
                        <li><a href="exercises/intermediate/ServiceDemo">ServiceDemo</a></li>
                        <li><a href="exercises/intermediate/RoutingDemo">RoutingDemo</a></li>
                        <li><a href="/search">SearchPage</a> (has own route)</li>
                        <li><a href="/product/1">ProductPage</a> (has own route)</li>
                        <li><a href="exercises/intermediate/TemplatedComponentDemo">TemplatedComponentDemo</a></li>
                        <li><a href="exercises/intermediate/SimpleCard">SimpleCard</a></li>
                        <li><a href="exercises/intermediate/RefDemo">RefDemo</a></li>
                        <li><a href="exercises/intermediate/AsyncDemo">AsyncDemo</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-danger text-white">Advanced</div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><a href="exercises/advanced/ApiDemo">ApiDemo</a></li>
                        <li><a href="exercises/advanced/WeatherDisplay">WeatherDisplay</a></li>
                        <li><a href="exercises/advanced/LoginStatus">LoginStatus</a></li>
                        <li><a href="exercises/advanced/ProtectedPage">ProtectedPage</a></li>
                        <li><a href="exercises/advanced/ThemeProvider">ThemeProvider</a></li>
                        <li><a href="exercises/advanced/ShoppingCart">ShoppingCart</a></li>
                        <li><a href="exercises/advanced/ErrorDemo">ErrorDemo</a></li>
                        <li><a href="exercises/advanced/LoggingDemo">LoggingDemo</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header bg-primary text-white">Radzen - DataGrid</div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><a href="exercises/radzenkoans/RadzenSetupDemo">RadzenSetupDemo</a></li>
                        <li><a href="exercises/radzenkoans/BasicDataGridDemo">BasicDataGridDemo</a></li>
                        <li><a href="exercises/radzenkoans/ColumnTypesDemo">ColumnTypesDemo</a></li>
                        <li><a href="exercises/radzenkoans/SortingDemo">SortingDemo</a></li>
                        <li><a href="exercises/radzenkoans/FilteringDemo">FilteringDemo</a></li>
                        <li><a href="exercises/radzenkoans/PagingDemo">PagingDemo</a></li>
                        <li><a href="exercises/radzenkoans/SelectionDemo">SelectionDemo</a></li>
                        <li><a href="exercises/radzenkoans/InlineEditingDemo">InlineEditingDemo</a></li>
                        <li><a href="exercises/radzenkoans/StateMachineEditingDemo">StateMachineEditingDemo</a></li>
                        <li><a href="exercises/radzenkoans/LoadDataDemo">LoadDataDemo</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header bg-primary text-white">Radzen - Forms & Layout</div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><a href="exercises/radzenkoans/TextInputsDemo">TextInputsDemo</a></li>
                        <li><a href="exercises/radzenkoans/NumericInputsDemo">NumericInputsDemo</a></li>
                        <li><a href="exercises/radzenkoans/DateInputsDemo">DateInputsDemo</a></li>
                        <li><a href="exercises/radzenkoans/DropdownsDemo">DropdownsDemo</a></li>
                        <li><a href="exercises/radzenkoans/CheckboxesDemo">CheckboxesDemo</a></li>
                        <li><a href="exercises/radzenkoans/RadzenValidationDemo">RadzenValidationDemo</a></li>
                        <li><a href="exercises/radzenkoans/CardsDemo">CardsDemo</a></li>
                        <li><a href="exercises/radzenkoans/PanelsDemo">PanelsDemo</a></li>
                        <li><a href="exercises/radzenkoans/TabsDemo">TabsDemo</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
}
else if (string.IsNullOrEmpty(ComponentName))
{
    <p><a href="exercises">&larr; Back to categories</a></p>
    <h2>@Category Components</h2>
}
else
{
    <p><a href="exercises">&larr; Back to categories</a></p>
    <h2>@ComponentName</h2>
    <hr />

    <div class="border p-3 bg-light">
        @RenderComponent()
    </div>
}

@code {
    [Parameter]
    public string? Category { get; set; }

    [Parameter]
    public string? ComponentName { get; set; }

    private RenderFragment RenderComponent() => builder =>
    {
        var componentType = GetComponentType();
        if (componentType != null)
        {
            builder.OpenComponent(0, componentType);
            builder.CloseComponent();
        }
        else
        {
            builder.AddContent(0, $"Component '{ComponentName}' not found in category '{Category}'");
        }
    };

    private Type? GetComponentType()
    {
        if (string.IsNullOrEmpty(Category) || string.IsNullOrEmpty(ComponentName))
            return null;

        // Handle special case for RadzenKoans folder
        var categoryPascal = Category.ToLower() switch
        {
            "radzenkoans" => "RadzenKoans",
            _ => char.ToUpper(Category[0]) + Category[1..].ToLower()
        };
        var typeName = $"BlazorKoans.App.Components.Exercises.{categoryPascal}.{ComponentName}";

        return Type.GetType(typeName + ", BlazorKoans.App");
    }
}
