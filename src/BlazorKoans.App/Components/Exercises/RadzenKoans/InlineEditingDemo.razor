@using BlazorKoans.App.Models
@using global::Radzen.Blazor
@using global::Radzen
@rendermode InteractiveServer

<h3>Inline Editing Demo</h3>

<RadzenDataGrid @ref="grid" Data="@employees" TItem="Employee"
                EditMode="global::Radzen.DataGridEditMode.Single"
                RowUpdate="@OnUpdateRow"
                RowCreate="@OnCreateRow"
                Style="width: 100%">
    <Columns>
        <RadzenDataGridColumn TItem="Employee" Property="Name" Title="Name">
            <EditTemplate Context="employee">
                <RadzenTextBox @bind-Value="employee.Name" Style="width: 100%" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="Employee" Property="Department" Title="Department">
            <EditTemplate Context="employee">
                <RadzenTextBox @bind-Value="employee.Department" Style="width: 100%" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="Employee" Property="Salary" Title="Salary" FormatString="{0:C}" TextAlign="global::Radzen.TextAlign.Right">
            <EditTemplate Context="employee">
                <RadzenNumeric @bind-Value="employee.Salary" Style="width: 100%" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="Employee" Property="HireDate" Title="Hire Date" FormatString="{0:d}">
            <EditTemplate Context="employee">
                <RadzenDatePicker @bind-Value="employee.HireDate" Style="width: 100%" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="Employee" Title="Actions" Width="200px" Sortable="false" Filterable="false">
            <Template Context="employee">
                <RadzenButton Icon="edit" ButtonStyle="global::Radzen.ButtonStyle.Light" Size="global::Radzen.ButtonSize.Small"
                              Click="@(() => EditRow(employee))" Text="Edit" />
            </Template>
            <EditTemplate Context="employee">
                <RadzenButton Icon="check" ButtonStyle="global::Radzen.ButtonStyle.Success" Size="global::Radzen.ButtonSize.Small"
                              Click="@(() => SaveRow(employee))" Text="Save" />
                <RadzenButton Icon="close" ButtonStyle="global::Radzen.ButtonStyle.Light" Size="global::Radzen.ButtonSize.Small"
                              Click="@(() => CancelEdit(employee))" Text="Cancel" />
            </EditTemplate>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

<RadzenButton Text="Add New Employee" Icon="add" Click="@InsertRow" Style="margin-top: 1rem" />

<div class="status-panel">
    <p>Last Action: @lastAction</p>
</div>

@code {
    private RadzenDataGrid<Employee>? grid;
    private List<Employee> employees = new()
    {
        new Employee { Id = 1, Name = "Alice Johnson", Department = "Engineering", Salary = 95000, HireDate = new DateTime(2020, 3, 15) },
        new Employee { Id = 2, Name = "Bob Smith", Department = "Marketing", Salary = 75000, HireDate = new DateTime(2021, 7, 1) },
        new Employee { Id = 3, Name = "Carol Williams", Department = "Engineering", Salary = 105000, HireDate = new DateTime(2019, 1, 10) }
    };

    private string lastAction = "None";

    private async Task EditRow(Employee employee)
    {
        if (grid != null)
        {
            await grid.EditRow(employee);
        }
    }

    private async Task SaveRow(Employee employee)
    {
        if (grid != null)
        {
            await grid.UpdateRow(employee);
        }
    }

    private async Task CancelEdit(Employee employee)
    {
        if (grid != null)
        {
            grid.CancelEditRow(employee);
        }
        lastAction = "Edit cancelled";
    }

    private async Task InsertRow()
    {
        if (grid != null)
        {
            var newEmployee = new Employee { Id = employees.Count + 1, HireDate = DateTime.Now };
            await grid.InsertRow(newEmployee);
        }
    }

    private void OnUpdateRow(Employee employee)
    {
        lastAction = $"Updated: {employee.Name}";
        StateHasChanged();
    }

    private void OnCreateRow(Employee employee)
    {
        employees.Add(employee);
        lastAction = $"Created: {employee.Name}";
        StateHasChanged();
    }
}
