@using BlazorKoans.App.Services
@inject CounterStateContainer StateContainer
@implements IDisposable

<div>
    <p>Cart Items: @StateContainer.Count</p>
    <button @onclick="AddItem">Add Item</button>
    <button @onclick="RemoveItem">Remove Item</button>
</div>

@code {
    private Action? _stateChangedHandler;

    protected override void OnInitialized()
    {
        _stateChangedHandler = () => InvokeAsync(StateHasChanged);
        StateContainer.OnChange += _stateChangedHandler;
    }

    private void AddItem()
    {
        StateContainer.Increment();
    }

    private void RemoveItem()
    {
        StateContainer.Decrement();
    }

    public void Dispose()
    {
        if (_stateChangedHandler != null)
        {
            StateContainer.OnChange -= _stateChangedHandler;
        }
    }
}
